<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraLink - Iniciar Sesi√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Paleta de Color Azul - Gradientes Personalizados */
        body { 
            background: linear-gradient(135deg, #000000 0%, #0a1128 50%, #000000 100%); 
            font-family: system-ui, -apple-system, sans-serif; 
            min-height: 100vh; 
        } 
        /* Gradiente de Azul para Texto y Resaltado */
        .gradient-text { 
            background: linear-gradient(135deg, #007CF0 0%, #00DFD8 100%); /* Azules Vibrantes */
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
        } 
        /* Bot√≥n Principal (Azul Claro) */
        .btn-primary { 
            background: linear-gradient(135deg, #007CF0 0%, #4092ff 100%); 
            transition: all 0.3s ease; 
        } 
        .btn-primary:hover { 
            transform: translateY(-2px); 
            /* Sombra azul */
            box-shadow: 0 10px 25px rgba(0, 124, 240, 0.4); 
        } 
        /* Bot√≥n Secundario (Azul Marino/Oscuro) */
        .btn-secondary { 
            background: linear-gradient(135deg, #0d47a1 0%, #1565c0 100%); 
            transition: all 0.3s ease; 
            border: 1px solid #1976d2; 
        } 
        .btn-secondary:hover { 
            transform: translateY(-2px); 
            /* Sombra azul oscura */
            box-shadow: 0 10px 25px rgba(13, 71, 161, 0.4); 
        } 
        
        /* Estilo para el bot√≥n de Google (Fondo oscuro, borde sutil) */
        .btn-google { 
            background-color: #1f2937; /* Gris oscuro para integrarse al fondo */
            color: #ffffff; 
            transition: all 0.3s ease; 
            border: 1px solid #374151; /* Borde gris m√°s claro */
        } 
        .btn-google:hover { 
            background-color: #2a3547; /* Ligeramente m√°s claro en hover */
            transform: translateY(-2px); 
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5); /* Sombra m√°s oscura y profunda */
        } 
        /* Animaci√≥n Flotante */
        .floating-animation { 
            animation: float 3s ease-in-out infinite; 
        } 
        @keyframes float { 
            0%, 100% { transform: translateY(0px); } 
            50% { transform: translateY(-5px); } 
        } 
        /* Estilos de Pesta√±as */
        .hidden { display: none !important; }
        .tab-active {
            background-color: #0d47a1; 
            color: white;
            box-shadow: 0 2px 10px rgba(0, 124, 240, 0.2);
        }
        .tab-inactive:hover {
            background-color: #1a237e; 
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-auth.js"></script>
</head>
<body class="flex flex-col items-center justify-center text-white p-4">

    <div id="authCard" class="w-full max-w-sm mx-auto my-auto p-8 bg-gray-900 rounded-2xl shadow-2xl border border-gray-800">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold gradient-text floating-animation">Ultra Link</h1>
            <p class="text-gray-400 mt-2">Conecta con el Mundo Digital</p>
        </header>

        <div class="flex p-1 bg-gray-800 rounded-xl mb-6 shadow-inner">
            <div id="loginTab" onclick="switchTab('login')" class="flex-1 py-3 rounded-xl tab-active font-semibold transition-all cursor-pointer text-center">
                Iniciar Sesi√≥n
            </div>
            <div id="registerTab" onclick="switchTab('register')" class="flex-1 py-3 rounded-xl bg-transparent text-gray-400 tab-inactive font-semibold transition-all cursor-pointer text-center">
                Registrarse
            </div>
        </div>
        
        <div id="authMessage" class="hidden"></div>

        <form id="authForm" class="space-y-5">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-300">Correo electr√≥nico</label>
                <input type="email" id="email" required class="w-full p-3 mt-1 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="tu_correo@ejemplo.com">
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-gray-300">Contrase√±a</label>
                <input type="password" id="password" required class="w-full p-3 mt-1 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            
            <button type="submit" class="btn-primary w-full py-3 rounded-lg font-bold text-lg shadow-xl">
                <span id="submitText">Iniciar Sesi√≥n</span>
            </button>
            
            <div id="forgotPassword" class="text-right pt-1">
                <a href="#" onclick="event.preventDefault(); resetPassword();" class="text-sm text-gray-400 hover:text-blue-400 transition-colors">
                    ¬øOlvidaste tu contrase√±a?
                </a>
            </div>
        </form>

        <div class="mt-7 text-center text-gray-500 relative">
            <hr class="border-gray-700 absolute inset-0 my-auto">
            <p class="inline-block px-3 bg-gray-900 relative z-10 text-sm">o contin√∫a con</p>
        </div>

        <div class="mt-5 space-y-4">
            <button onclick="signInWithGoogle()" class="btn-google w-full py-3 rounded-lg font-semibold flex items-center justify-center shadow-md">
                <svg class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22.5 12.0003C22.5 11.2013 22.4257 10.4357 22.285 9.70258H12.25V13.8841H17.808C17.5647 15.0298 16.8927 16.0336 15.899 16.6908V19.4449H19.508C21.7827 17.304 23.0003 14.3986 23.0003 12.0003C23.0003 11.6669 22.977 11.3411 22.946 11.0232L22.9964 10.9785C22.9997 10.957 23.0003 10.9355 23.0003 10.9141V10.9135L22.5 12.0003Z" fill="#4285F4"/>
                    <path d="M12.25 23.0003C15.4855 23.0003 18.232 21.9056 20.2526 19.9576L16.0596 16.5912C15.0064 17.3308 13.7225 17.8085 12.25 17.8085C9.39762 17.8085 6.94586 15.8906 6.09633 13.3496H1.874V16.7118C3.89461 20.6698 7.79461 23.0003 12.25 23.0003Z" fill="#34A853"/>
                    <path d="M6.09633 13.3496C5.8778 12.7208 5.76707 12.0003 5.76707 11.35C5.76707 10.7077 5.8778 10.0094 6.08418 9.39097V6.01465H1.874C1.10979 7.64756 0.612061 9.47956 0.612061 11.35C0.612061 13.2205 1.10979 15.0525 1.874 16.6854L6.09633 13.3496Z" fill="#FBBC05"/>
                    <path d="M12.25 5.2503C14.072 5.2503 15.6318 5.95292 16.9455 7.1511L20.2526 3.82476C18.232 1.87679 15.4855 0.750305 12.25 0.750305C7.79461 0.750305 3.89461 3.08085 1.874 7.03886L6.08418 10.3951C6.94586 7.85408 9.39762 5.93623 12.25 5.93623C12.75 5.93623 13.2642 5.99222 13.7642 6.10425L13.7667 6.10492L13.7667 6.10492L12.25 5.2503Z" fill="#EA4335"/>
                </svg>
                Continuar con Google
            </button>
            
            <button onclick="document.getElementById('phoneAuthContainer').classList.remove('hidden'); hideMessage();" class="btn-secondary w-full py-3 rounded-lg font-bold text-lg shadow-xl flex items-center justify-center">
                <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.717 21 3 14.283 3 6V5z"/>
                </svg>
                Continuar con Tel√©fono
            </button>
        </div>
        
        <div id="phoneAuthContainer" class="mt-6 p-5 bg-gray-800 rounded-xl shadow-inner hidden border border-gray-700">
            <h3 class="text-white font-bold mb-3">Ingresa tu n√∫mero</h3>
            
            <div class="mb-4">
                <label for="phoneNumber" class="block text-sm font-medium text-gray-400">N√∫mero (Ej: +54 9 223...)</label>
                <input type="tel" id="phoneNumber" placeholder="+54 9..." class="w-full p-3 mt-1 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400" required>
            </div>
            
            <button id="sendSmsButton" onclick="signInWithPhone()" class="btn-primary w-full py-3 rounded-lg font-bold shadow-xl">
                Enviar C√≥digo SMS
            </button>
            
            <div id="verifyCodeContainer" class="mt-4 hidden">
                <label for="verificationCode" class="block text-sm font-medium text-gray-400">C√≥digo de Verificaci√≥n</label>
                <input type="text" id="verificationCode" placeholder="######" class="w-full p-3 mt-1 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400" required>
                <button onclick="verifyCode()" class="btn-secondary w-full py-3 mt-3 rounded-lg font-bold shadow-xl">
                    Verificar y Entrar
                </button>
            </div>
        </div>

        <div id="recaptcha-container" class="mt-5 flex justify-center"></div> 
        
    </div> 
    
    <footer class="mt-10 text-center text-gray-500 w-full max-w-sm">
        <div class="flex justify-center space-x-8 mb-4">
            <div class="text-center">
                <p class="text-xl font-bold gradient-text">34+</p>
                <p class="text-sm">Servicios</p>
            </div>
            <div class="text-center">
                <p class="text-xl font-bold gradient-text">24/7</p>
                <p class="text-sm">Soporte</p>
            </div>
            <div class="text-center">
                <p class="text-xl font-bold gradient-text">100%</p>
                <p class="text-sm">Seguro</p>
            </div>
        </div>
        <p class="text-xs">&copy; 2025 UltraLink. Todos los derechos reservados.</p>
    </footer>

    <script>
        // CONFIGURACI√ìN DE FIREBASE (sin cambios funcionales)
        const firebaseConfig = {
            apiKey: "AIzaSyBVdwu74rhD6753ChjVC1PcIAbpQ8th9Rk",
            authDomain: "ultralinkargentina-97c4d.firebaseapp.com",
            projectId: "ultralinkargentina-97c4d",
            storageBucket: "ultralinkargentina-97c4d.appspot.com",
            messagingSenderId: "352589034055",
            appId: "1:352589034055:web:0680b9da02bf0060717762",
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        let confirmationResult = null;

        auth.onAuthStateChanged(user => {
            const authCard = document.getElementById('authCard');
            if (user) {
                authCard.classList.add('hidden');
                showMessage(`¬°Sesi√≥n activa! Hola, ${user.email || user.phoneNumber || 'usuario'} üëã. Redirigiendo...`, 'success');
                setTimeout(() => {
                    window.location.href = 'services.html'; 
                }, 1000);
            } else {
                authCard.classList.remove('hidden');
            }
        });

        function switchTab(mode) {
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const submitText = document.getElementById('submitText');
            const forgotPassword = document.getElementById('forgotPassword');
            
            document.getElementById('phoneAuthContainer').classList.add('hidden'); 
            
            if (mode === 'login') {
                loginTab.className = 'flex-1 py-3 rounded-xl tab-active font-semibold transition-all cursor-pointer text-center';
                registerTab.className = 'flex-1 py-3 rounded-xl bg-transparent text-gray-400 tab-inactive font-semibold transition-all cursor-pointer text-center';
                submitText.textContent = 'Iniciar Sesi√≥n';
                forgotPassword.classList.remove('hidden');
            } else {
                loginTab.className = 'flex-1 py-3 rounded-xl bg-transparent text-gray-400 tab-inactive font-semibold transition-all cursor-pointer text-center';
                registerTab.className = 'flex-1 py-3 rounded-xl tab-active font-semibold transition-all cursor-pointer text-center';
                submitText.textContent = 'Crear Cuenta';
                forgotPassword.classList.add('hidden');
            }
            hideMessage();
        }

        function showMessage(message, type) {
            const msgEl = document.getElementById('authMessage');
            msgEl.textContent = message;
            msgEl.className = `mb-4 p-4 rounded-lg text-sm ${type === 'error' ? 'bg-red-900 bg-opacity-50 text-red-200 border border-red-800' : 'bg-blue-900 bg-opacity-50 text-blue-200 border border-blue-800'}`;
            msgEl.classList.remove('hidden');
        }

        function hideMessage() {
            document.getElementById('authMessage').classList.add('hidden');
        }

        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const isLogin = document.getElementById('loginTab').className.includes('tab-active');
            
            document.getElementById('phoneAuthContainer').classList.add('hidden');

            try {
                if (isLogin) {
                    await auth.signInWithEmailAndPassword(email, password);
                    showMessage('¬°Inicio de sesi√≥n exitoso! Redirigiendo...', 'success');
                } else {
                    await auth.createUserWithEmailAndPassword(email, password);
                    showMessage('¬°Cuenta creada exitosamente! Redirigiendo...', 'success');
                }
            } catch (error) {
                let errorMsg = 'Error al procesar la solicitud.';
                if (error.code === 'auth/email-already-in-use') errorMsg = 'Este correo ya est√° registrado.';
                if (error.code === 'auth/invalid-email') errorMsg = 'Correo electr√≥nico inv√°lido.';
                if (error.code === 'auth/weak-password') errorMsg = 'La contrase√±a debe tener al menos 6 caracteres.';
                if (error.code === 'auth/user-not-found') errorMsg = 'Usuario no encontrado.';
                if (error.code === 'auth/wrong-password') errorMsg = 'Contrase√±a incorrecta.';
                if (error.code === 'auth/invalid-credential') errorMsg = 'Credenciales inv√°lidas.';
                showMessage(errorMsg, 'error');
                console.error('Firebase Error:', error.code, error.message);
            }
        });

        async function signInWithGoogle() {
            document.getElementById('phoneAuthContainer').classList.add('hidden');

            try {
                await auth.signInWithPopup(googleProvider);
            } catch (error) {
                if (error.code !== 'auth/popup-closed-by-user') {
                    showMessage('Error al iniciar sesi√≥n con Google', 'error');
                }
                console.error('Firebase Google Auth Error:', error);
            }
        }

        async function resetPassword() {
            const email = document.getElementById('email').value;
            if (!email) {
                showMessage('Por favor ingresa tu correo electr√≥nico en el campo para enviarte el enlace de recuperaci√≥n.', 'error');
                return;
            }
            try {
                await auth.sendPasswordResetEmail(email);
                showMessage('¬°Correo de recuperaci√≥n enviado! Revisa tu bandeja de entrada y spam.', 'success');
            } catch (error) {
                let errorMsg = 'Error al enviar correo de recuperaci√≥n.';
                if (error.code === 'auth/user-not-found') errorMsg = 'No existe un usuario con ese correo.';
                showMessage(errorMsg, 'error');
                console.error('Firebase Reset Password Error:', error);
            }
        }

        // L√≥gica de Autenticaci√≥n por Tel√©fono (SMS) - MODIFICADA PARA DEBUGGING
        async function signInWithPhone() {
            const phoneNumber = document.getElementById('phoneNumber').value;
            
            if (!phoneNumber.startsWith('+') || phoneNumber.length < 10) {
                showMessage('Por favor, ingresa el n√∫mero de tel√©fono con el c√≥digo de pa√≠s (ej: +54 9...).', 'error');
                return;
            }

            try {
                const recaptcha = window.recaptchaVerifier;
                if (!recaptcha) {
                    showMessage('Error: El verificador reCAPTCHA no est√° inicializado.', 'error');
                    return;
                }

                document.getElementById('sendSmsButton').classList.add('hidden');
                document.getElementById('verifyCodeContainer').classList.remove('hidden');

                confirmationResult = await auth.signInWithPhoneNumber(phoneNumber, recaptcha);
                showMessage(`C√≥digo de verificaci√≥n enviado a ${phoneNumber}.`, 'success');

            } catch (error) {
                // INICIO DE LA MODIFICACI√ìN DE DEBUGGING
                let errorMsg = 'Error al enviar el c√≥digo SMS. Int√©ntalo de nuevo.';
                
                if (error.code === 'auth/invalid-phone-number') {
                    errorMsg = 'El n√∫mero de tel√©fono es inv√°lido o el formato es incorrecto.';
                } else if (error.code === 'auth/quota-exceeded') {
                    errorMsg = 'Se ha excedido la cuota de SMS para este proyecto. Revisa la facturaci√≥n de Firebase.';
                } else if (error.code) {
                    // MUESTRA EL C√ìDIGO DE ERROR DE FIREBASE SI NO ES NINGUNO DE LOS ANTERIORES
                    errorMsg = `FALLO CR√çTICO: ${error.code}.`;
                }
                
                showMessage(errorMsg, 'error');
                
                console.error('Firebase Phone Auth Error:', error.code, error.message);
                // FIN DE LA MODIFICACI√ìN DE DEBUGGING
                
                document.getElementById('sendSmsButton').classList.remove('hidden');
                document.getElementById('verifyCodeContainer').classList.add('hidden');
            }
        }

        async function verifyCode() {
            const code = document.getElementById('verificationCode').value;
            if (!code) {
                showMessage('Por favor, ingresa el c√≥digo de 6 d√≠gitos recibido.', 'error');
                return;
            }

            try {
                if (!confirmationResult) {
                    showMessage('Error: No se ha solicitado el c√≥digo SMS. Intenta enviar de nuevo.', 'error');
                    return;
                }
                
                await confirmationResult.confirm(code);
                showMessage('¬°Inicio de sesi√≥n con tel√©fono exitoso! Redirigiendo...', 'success');

            } catch (error) {
                let errorMsg = 'C√≥digo de verificaci√≥n incorrecto o expirado.';
                if (error.code === 'auth/invalid-verification-code') errorMsg = 'El c√≥digo ingresado es incorrecto.';
                showMessage(errorMsg, 'error');
                console.error('Firebase SMS Verify Error:', error.code, error.message);
            }
        }

        window.addEventListener('load', () => {
            const recaptchaContainer = document.getElementById('recaptcha-container');
            if (recaptchaContainer) {
                window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                    'size': 'normal' 
                });
                recaptchaVerifier.render(); 
            }
        });
    </script>
</body>
</html>
