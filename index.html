<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraLink - Iniciar Sesi√≥n</title>
    <style>
        /* Estilos CSS originales */ 
        body { 
            background: linear-gradient(135deg, #000000 0%, #1a1a2e 50%, #000000 100%); 
            font-family: system-ui, -apple-system, sans-serif; 
            min-height: 100vh; 
        } 
        .gradient-border { 
            background: linear-gradient(135deg, #3b4f9e 0%, #ff6b35 100%); 
            padding: 2px; 
            border-radius: 1rem; 
        } 
        .gradient-text { 
            background: linear-gradient(135deg, #3b4f9e 0%, #ff6b35 100%); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
        } 
        .btn-primary { 
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c5a 100%); 
            transition: all 0.3s ease; 
        } 
        .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.3); 
        } 
        .btn-secondary { 
            background: linear-gradient(135deg, #3b4f9e 0%, #5a6fbf 100%); 
            transition: all 0.3s ease; 
        } 
        .btn-secondary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 25px rgba(59, 79, 158, 0.3); 
        } 
        .btn-google { 
            background-color: #fff; 
            color: #333; 
            transition: all 0.3s ease; 
        } 
        .btn-google:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 25px rgba(0,0,0,0.15); 
        } 
        /* ‚ùå ELIMINADO: Ya no necesitamos el estilo de Facebook */
        /* .btn-facebook { background-color: #1877f2; transition: all 0.3s ease; } */ 
        /* .btn-facebook:hover { transform: translateY(-2px); background-color: #0d65d9; box-shadow: 0 10px 25px rgba(24, 119, 242, 0.3); } */ 
        .floating-animation { 
            animation: float 3s ease-in-out infinite; 
        } 
        @keyframes float { 
            0%, 100% { transform: translateY(0px); } 
            50% { transform: translateY(-10px); } 
        } 
        /* Estilo para simular una clase 'hidden' si no usas Tailwind */
        .hidden { display: none !important; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-auth.js"></script>
</head>
<body class="flex flex-col items-center justify-center text-white p-4">

    <div id="authCard" class="w-full max-w-sm mx-auto my-auto p-6 bg-gray-900 rounded-xl shadow-2xl">
        
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold gradient-text">Ultra Link</h1>
            <p class="text-gray-400 mt-1">Conecta con el Mundo Digital</p>
        </header>

        <div class="flex p-1 bg-gray-800 rounded-lg mb-6">
            <div id="loginTab" onclick="switchTab('login')" class="flex-1 py-3 rounded-lg bg-gray-800 text-white font-semibold transition-all cursor-pointer text-center">
                Iniciar Sesi√≥n
            </div>
            <div id="registerTab" onclick="switchTab('register')" class="flex-1 py-3 rounded-lg bg-transparent text-gray-400 font-semibold border border-gray-800 transition-all hover:border-gray-700 cursor-pointer text-center">
                Registrarse
            </div>
        </div>
        
        <div id="authMessage" class="hidden"></div>

        <form id="authForm" class="space-y-4">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-400">Correo electr√≥nico</label>
                <input type="email" id="email" required class="w-full p-3 mt-1 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500" placeholder="tu_correo@ejemplo.com">
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-gray-400">Contrase√±a</label>
                <input type="password" id="password" required class="w-full p-3 mt-1 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            
            <button type="submit" class="btn-primary w-full py-3 rounded-lg font-semibold shadow-lg">
                <span id="submitText">Iniciar Sesi√≥n</span>
            </button>
            
            <div id="forgotPassword" class="text-right mt-2">
                <a href="#" onclick="event.preventDefault(); resetPassword();" class="text-sm text-gray-400 hover:text-orange-400 transition-colors">
                    ¬øOlvidaste tu contrase√±a?
                </a>
            </div>
        </form>

        <div class="mt-6 text-center text-gray-500">
            <p>o contin√∫a con</p>
        </div>

        <div class="mt-4 space-y-3">
            <button onclick="signInWithGoogle()" class="btn-google w-full py-3 rounded-lg font-semibold border border-gray-300 flex items-center justify-center shadow-md">
                <img src="google_icon.png" alt="Google" class="w-5 h-5 mr-3"> Continuar con Google
            </button>
            
            <button onclick="document.getElementById('phoneAuthContainer').classList.remove('hidden'); hideMessage();" class="btn-secondary w-full py-3 rounded-lg font-semibold shadow-lg">
                Continuar con Tel√©fono
            </button>
        </div>
        
        <div id="phoneAuthContainer" class="mt-6 p-4 bg-gray-800 rounded-lg shadow-inner hidden">
            <h3 class="text-white font-semibold mb-3">Ingresa tu n√∫mero</h3>
            
            <div class="mb-4">
                <label for="phoneNumber" class="block text-sm font-medium text-gray-400">N√∫mero (Ej: +54 9 223...)</label>
                <input type="tel" id="phoneNumber" placeholder="+54 9..." class="w-full p-3 mt-1 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500" required>
            </div>
            
            <button id="sendSmsButton" onclick="signInWithPhone()" class="btn-primary w-full py-3 rounded-lg font-semibold shadow-lg">
                Enviar C√≥digo SMS
            </button>
            
            <div id="verifyCodeContainer" class="mt-4 hidden">
                <label for="verificationCode" class="block text-sm font-medium text-gray-400">C√≥digo de Verificaci√≥n</label>
                <input type="text" id="verificationCode" placeholder="######" class="w-full p-3 mt-1 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500" required>
                <button onclick="verifyCode()" class="btn-secondary w-full py-3 mt-3 rounded-lg font-semibold shadow-lg">
                    Verificar y Entrar
                </button>
            </div>
        </div>
        
        <div id="recaptcha-container"></div> 
        
    </div> <footer class="mt-10 text-center text-gray-500">
        <div class="flex justify-center space-x-8 mb-4">
            <div class="text-center">
                <p class="text-xl font-bold gradient-text">34+</p>
                <p class="text-sm">Servicios</p>
            </div>
            <div class="text-center">
                <p class="text-xl font-bold gradient-text">24/7</p>
                <p class="text-sm">Soporte</p>
            </div>
            <div class="text-center">
                <p class="text-xl font-bold gradient-text">100%</p>
                <p class="text-sm">Seguro</p>
            </div>
        </div>
        <p class="text-xs">&copy; 2025 UltraLink. Todos los derechos reservados.</p>
    </footer>

    <script>
        // CONFIGURACI√ìN DE FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyBVdwu74rhD6753ChjVC1PcIAbpQ8th9Rk",
            authDomain: "ultralinkargentina-97c4d.firebaseapp.com",
            projectId: "ultralinkargentina-97c4d",
            storageBucket: "ultralinkargentina-97c4d.appspot.com",
            messagingSenderId: "352589034055",
            appId: "1:352589034055:web:0680b9da02bf0060717762",
        };
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // üí° Inicializaci√≥n de Proveedores de Auth Social para compatibilidad
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        // ‚ùå C√ìDIGO REMOVIDO: Se elimina el proveedor de Facebook
        // const facebookProvider = new firebase.auth.FacebookAuthProvider();

        // üìû NUEVO C√ìDIGO: Variable para el ID de confirmaci√≥n de SMS
        let confirmationResult = null;

        // L√≥gica de Redirecci√≥n (Si est√° logueado, redirige)
        auth.onAuthStateChanged(user => {
            const authCard = document.getElementById('authCard');
            if (user) {
                // Usuario logueado. Ocultar el formulario de Login y redirigir
                authCard.classList.add('hidden');
                showMessage(`¬°Sesi√≥n activa! Hola, ${user.email || user.phoneNumber || 'usuario'} üëã. Redirigiendo...`, 'success');
                // Redirigir a la p√°gina principal despu√©s de un peque√±o retraso
                setTimeout(() => {
                    window.location.href = 'services.html';
                }, 1000);
            } else {
                // Usuario NO logueado. Mostrar el formulario de Login (si estaba oculto)
                authCard.classList.remove('hidden');
            }
        });

        // Resto de tus funciones (switchTab, showMessage, etc.)
        function switchTab(mode) {
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const submitText = document.getElementById('submitText');
            const forgotPassword = document.getElementById('forgotPassword');
            
            // üìû NUEVO C√ìDIGO: Ocultar el formulario de SMS al cambiar de pesta√±a
            document.getElementById('phoneAuthContainer').classList.add('hidden'); 
            
            if (mode === 'login') {
                loginTab.className = 'flex-1 py-3 rounded-lg bg-gray-800 text-white font-semibold transition-all';
                registerTab.className = 'flex-1 py-3 rounded-lg bg-transparent text-gray-400 font-semibold border border-gray-800 transition-all hover:border-gray-700';
                submitText.textContent = 'Iniciar Sesi√≥n';
                forgotPassword.classList.remove('hidden');
            } else {
                loginTab.className = 'flex-1 py-3 rounded-lg bg-transparent text-gray-400 font-semibold border border-gray-800 transition-all hover:border-gray-700';
                registerTab.className = 'flex-1 py-3 rounded-lg bg-gray-800 text-white font-semibold transition-all';
                submitText.textContent = 'Crear Cuenta';
                forgotPassword.classList.add('hidden');
            }
            hideMessage();
        }

        // Funciones de utilidad para mensajes
        function showMessage(message, type) {
            const msgEl = document.getElementById('authMessage');
            msgEl.textContent = message;
            msgEl.className = `mb-4 p-4 rounded-lg text-sm ${type === 'error' ? 'bg-red-900 bg-opacity-50 text-red-200 border border-red-800' : 'bg-green-900 bg-opacity-50 text-green-200 border border-green-800'}`;
            msgEl.classList.remove('hidden');
        }

        function hideMessage() {
            document.getElementById('authMessage').classList.add('hidden');
        }

        // Manejador del Formulario (Login/Registro con Email y Contrase√±a)
        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const isLogin = document.getElementById('loginTab').className.includes('bg-gray-800');
            
            // üìû NUEVO C√ìDIGO: Ocultar el formulario de SMS al usar el formulario principal
            document.getElementById('phoneAuthContainer').classList.add('hidden');

            try {
                if (isLogin) {
                    await auth.signInWithEmailAndPassword(email, password);
                    showMessage('¬°Inicio de sesi√≥n exitoso! Redirigiendo...', 'success');
                } else {
                    await auth.createUserWithEmailAndPassword(email, password);
                    showMessage('¬°Cuenta creada exitosamente! Redirigiendo...', 'success');
                }
            } catch (error) {
                // Manejo de errores espec√≠ficos de Firebase
                let errorMsg = 'Error al procesar la solicitud.';
                if (error.code === 'auth/email-already-in-use') errorMsg = 'Este correo ya est√° registrado.';
                if (error.code === 'auth/invalid-email') errorMsg = 'Correo electr√≥nico inv√°lido.';
                if (error.code === 'auth/weak-password') errorMsg = 'La contrase√±a debe tener al menos 6 caracteres.';
                if (error.code === 'auth/user-not-found') errorMsg = 'Usuario no encontrado.';
                if (error.code === 'auth/wrong-password') errorMsg = 'Contrase√±a incorrecta.';
                if (error.code === 'auth/invalid-credential') errorMsg = 'Credenciales inv√°lidas.';
                showMessage(errorMsg, 'error');
                console.error('Firebase Error:', error.code, error.message);
            }
        });

        // üü¢ Login con Google (Usando el provider inicializado)
        async function signInWithGoogle() {
            // üìû NUEVO C√ìDIGO: Ocultar el formulario de SMS al usar Google
            document.getElementById('phoneAuthContainer').classList.add('hidden');

            try {
                await auth.signInWithPopup(googleProvider);
                // La redirecci√≥n ocurre autom√°ticamente por 'onAuthStateChanged'
            } catch (error) {
                if (error.code !== 'auth/popup-closed-by-user') {
                    showMessage('Error al iniciar sesi√≥n con Google', 'error');
                }
                console.error('Firebase Google Auth Error:', error);
            }
        }

        // ‚ùå C√ìDIGO REMOVIDO: Se elimina la funci√≥n de Login con Facebook
        // async function signInWithFacebook() { /* ... */ } 

        // Recuperar contrase√±a
        async function resetPassword() {
            const email = document.getElementById('email').value;
            if (!email) {
                showMessage('Por favor ingresa tu correo electr√≥nico en el campo para enviarte el enlace de recuperaci√≥n.', 'error');
                return;
            }
            try {
                await auth.sendPasswordResetEmail(email);
                showMessage('¬°Correo de recuperaci√≥n enviado! Revisa tu bandeja de entrada y spam.', 'success');
            } catch (error) {
                let errorMsg = 'Error al enviar correo de recuperaci√≥n.';
                if (error.code === 'auth/user-not-found') errorMsg = 'No existe un usuario con ese correo.';
                showMessage(errorMsg, 'error');
                console.error('Firebase Reset Password Error:', error);
            }
        }

        // üìûüìû NUEVO C√ìDIGO: L√≥gica de Autenticaci√≥n por Tel√©fono (SMS) üìûüìû

        // Funci√≥n para inicializar reCAPTCHA y enviar el c√≥digo SMS
        async function signInWithPhone() {
            const phoneNumber = document.getElementById('phoneNumber').value;
            
            // Validar formato b√°sico del n√∫mero (ej: +54 9 223 XXX XXXX)
            if (!phoneNumber.startsWith('+') || phoneNumber.length < 10) {
                showMessage('Por favor, ingresa el n√∫mero de tel√©fono con el c√≥digo de pa√≠s (ej: +54 9...).', 'error');
                return;
            }

            try {
                const recaptcha = window.recaptchaVerifier;
                if (!recaptcha) {
                    showMessage('Error: El verificador reCAPTCHA no est√° inicializado.', 'error');
                    return;
                }

                // Esconder el bot√≥n de "Enviar SMS" y mostrar el formulario de c√≥digo
                document.getElementById('sendSmsButton').classList.add('hidden');
                document.getElementById('verifyCodeContainer').classList.remove('hidden');

                // Enviar el c√≥digo de verificaci√≥n
                confirmationResult = await auth.signInWithPhoneNumber(phoneNumber, recaptcha);
                showMessage(`C√≥digo de verificaci√≥n enviado a ${phoneNumber}.`, 'success');

            } catch (error) {
                // Manejar errores de reCAPTCHA o SMS
                let errorMsg = 'Error al enviar el c√≥digo SMS. Int√©ntalo de nuevo.';
                if (error.code === 'auth/invalid-phone-number') errorMsg = 'El n√∫mero de tel√©fono es inv√°lido o el formato es incorrecto.';
                if (error.code === 'auth/quota-exceeded') errorMsg = 'Se ha excedido la cuota de SMS para este proyecto. Revisa la facturaci√≥n de Firebase.';
                showMessage(errorMsg, 'error');
                console.error('Firebase Phone Auth Error:', error.code, error.message);
                
                // Mostrar de nuevo el bot√≥n de enviar si falla
                document.getElementById('sendSmsButton').classList.remove('hidden');
                document.getElementById('verifyCodeContainer').classList.add('hidden');
            }
        }

        // Funci√≥n para verificar el c√≥digo SMS
        async function verifyCode() {
            const code = document.getElementById('verificationCode').value;
            if (!code) {
                showMessage('Por favor, ingresa el c√≥digo de 6 d√≠gitos recibido.', 'error');
                return;
            }

            try {
                if (!confirmationResult) {
                    showMessage('Error: No se ha solicitado el c√≥digo SMS. Intenta enviar de nuevo.', 'error');
                    return;
                }
                
                // Finalizar la sesi√≥n con el c√≥digo
                await confirmationResult.confirm(code);
                // Si tiene √©xito, onAuthStateChanged manejar√° la redirecci√≥n
                showMessage('¬°Inicio de sesi√≥n con tel√©fono exitoso! Redirigiendo...', 'success');

            } catch (error) {
                let errorMsg = 'C√≥digo de verificaci√≥n incorrecto o expirado.';
                if (error.code === 'auth/invalid-verification-code') errorMsg = 'El c√≥digo ingresado es incorrecto.';
                showMessage(errorMsg, 'error');
                console.error('Firebase SMS Verify Error:', error.code, error.message);
            }
        }

        // üìû NUEVO C√ìDIGO: Inicializaci√≥n del verificador reCAPTCHA
        window.addEventListener('load', () => {
            const recaptchaContainer = document.getElementById('recaptcha-container');
            if (recaptchaContainer) {
                window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                    'size': 'invisible' // invisible es ideal para no mostrar la caja
                });
                recaptchaVerifier.render(); // Renderiza el reCAPTCHA
            }
        });
    </script>
</body>
</html>
