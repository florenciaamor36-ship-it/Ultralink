<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraLink - Iniciar Sesi√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* [Omitting CSS styles for brevity, assuming you have them] */
        body { 
            background: linear-gradient(135deg, #000000 0%, #0a1128 50%, #000000 100%); 
            font-family: system-ui, -apple-system, sans-serif; 
            min-height: 100vh; 
        } 
        /* ... (tus estilos) ... */
        .gradient-text { 
            background: linear-gradient(135deg, #007CF0 0%, #00DFD8 100%); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
        } 
        .btn-primary { 
            background: linear-gradient(135deg, #007CF0 0%, #4092ff 100%); 
            transition: all 0.3s ease; 
        } 
        .btn-google { 
            background-color: #1f2937; 
            color: #ffffff; 
            transition: all 0.3s ease; 
            border: 1px solid #374151; 
        } 
        .hidden { display: none !important; }
        .tab-active {
            background-color: #0d47a1; 
            color: white;
            box-shadow: 0 2px 10px rgba(0, 124, 240, 0.2);
        }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body class="flex flex-col items-center justify-center text-white p-4">

    <div id="authCard" class="w-full max-w-sm mx-auto my-auto p-8 bg-gray-900 rounded-2xl shadow-2xl border border-gray-800">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold gradient-text floating-animation">Ultra Link</h1>
            <p class="text-gray-400 mt-2">Conecta con el Mundo Digital</p>
        </header>

        <div class="flex p-1 bg-gray-800 rounded-xl mb-6 shadow-inner">
            <div id="loginTab" onclick="switchTab('login')" class="flex-1 py-3 rounded-xl tab-active font-semibold transition-all cursor-pointer text-center">
                Iniciar Sesi√≥n
            </div>
            <div id="registerTab" onclick="switchTab('register')" class="flex-1 py-3 rounded-xl bg-transparent text-gray-400 tab-inactive font-semibold transition-all cursor-pointer text-center">
                Registrarse
            </div>
        </div>
        
        <div id="authMessage" class="hidden"></div>

        <form id="authForm" class="space-y-5">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-300">Correo electr√≥nico</label>
                <input type="email" id="email" required class="w-full p-3 mt-1 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="tu_correo@ejemplo.com">
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-gray-300">Contrase√±a</label>
                <input type="password" id="password" required class="w-full p-3 mt-1 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            
            <button type="submit" class="btn-primary w-full py-3 rounded-lg font-bold text-lg shadow-xl">
                <span id="submitText">Iniciar Sesi√≥n</span>
            </button>
            
            <div id="forgotPassword" class="text-right pt-1">
                <a href="#" onclick="event.preventDefault(); resetPassword();" class="text-sm text-gray-400 hover:text-blue-400 transition-colors">
                    ¬øOlvidaste tu contrase√±a?
                </a>
            </div>
        </form>

        <div class="mt-7 text-center text-gray-500 relative">
            <hr class="border-gray-700 absolute inset-0 my-auto">
            <p class="inline-block px-3 bg-gray-900 relative z-10 text-sm">o contin√∫a con</p>
        </div>

        <div class="mt-5 space-y-4">
            <button onclick="signInWithGoogleRedirect()" class="btn-google w-full py-3 rounded-lg font-semibold flex items-center justify-center shadow-md">
                <svg class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22.5 12.0003C22.5 11.2013 22.4257 10.4357 22.285 9.70258H12.25V13.8841H17.808C17.5647 15.0298 16.8927 16.0336 15.899 16.6908V19.4449H19.508C21.7827 17.304 23.0003 14.3986 23.0003 12.0003C23.0003 11.6669 22.977 11.3411 22.946 11.0232L22.9964 10.9785C22.9997 10.957 23.0003 10.9355 23.0003 10.9141V10.9135L22.5 12.0003Z" fill="#4285F4"/>
                    <path d="M12.25 23.0003C15.4855 23.0003 18.232 21.9056 20.2526 19.9576L16.0596 16.5912C15.0064 17.3308 13.7225 17.8085 12.25 17.8085C9.39762 17.8085 6.94586 15.8906 6.09633 13.3496H1.874V16.7118C3.89461 20.6698 7.79461 23.0003 12.25 23.0003Z" fill="#34A853"/>
                    <path d="M6.09633 13.3496C5.8778 12.7208 5.76707 12.0003 5.76707 11.35C5.76707 10.7077 5.8778 10.0094 6.08418 9.39097V6.01465H1.874C1.10979 7.64756 0.612061 9.47956 0.612061 11.35C0.612061 13.2205 1.10979 15.0525 1.874 16.6854L6.09633 13.3496Z" fill="#FBBC05"/>
                    <path d="M12.25 5.2503C14.072 5.2503 15.6318 5.95292 16.9455 7.1511L20.2526 3.82476C18.232 1.87679 15.4855 0.750305 12.25 0.750305C7.79461 0.750305 3.89461 3.08085 1.874 7.03886L6.08418 10.3951C6.94586 7.85408 9.39762 5.93623 12.25 5.93623C12.75 5.93623 13.2642 5.99222 13.7642 6.10425L13.7667 6.10492L13.7667 6.10492L12.25 5.2503Z" fill="#EA4335"/>
                </svg>
                Continuar con Google
            </button>
        </div>
        
    </div> 
    
    <footer class="mt-10 text-center text-gray-500 w-full max-w-sm">
        <div class="flex justify-center space-x-8 mb-4">
            <div class="text-center">
                <p class="text-xl font-bold gradient-text">34+</p>
                <p class="text-sm">Servicios</p>
            </div>
            <div class="text-center">
                <p class="text-xl font-bold gradient-text">24/7</p>
                <p class="text-sm">Soporte</p>
            </div>
            <div class="text-center">
                <p class="text-xl font-bold gradient-text">100%</p>
                <p class="text-sm">Seguro</p>
            </div>
        </div>
        <p class="text-xs">&copy; 2025 UltraLink. Todos los derechos reservados.</p>
    </footer>

    <script>
        // CONFIGURACI√ìN DE FIREBASE 
        const firebaseConfig = {
            apiKey: "AIzaSyBVdwu74rhD6753ChjVC1PcIAbpQ8th9Rk",
            authDomain: "ultralinkargentina-97c4d.firebaseapp.com",
            projectId: "ultralinkargentina-97c4d",
            storageBucket: "ultralinkargentina-97c4d.appspot.com",
            messagingSenderId: "352589034055",
            appId: "1:352589034055:web:0680b9da02bf0060717762",
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        
        // --- FUNCI√ìN DE REDIRECCI√ìN ---
        function redirectToServices() {
             setTimeout(() => {
                window.location.href = 'services.html'; 
            }, 500);
        }

        // --- L√ìGICA DE MANEJO DE REDIRECCI√ìN EN EL INICIO ---
        // Esto verifica si el usuario acaba de regresar del pop-up/redirecci√≥n de Google.
        auth.getRedirectResult().then((result) => {
            if (result.user) {
                // Autenticaci√≥n exitosa despu√©s de la redirecci√≥n
                showMessage('¬°Inicio de sesi√≥n con Google exitoso! Redirigiendo...', 'success');
                redirectToServices();
            }
        }).catch((error) => {
             // Manejo de errores de la redirecci√≥n (si la persona cancel√≥, etc.)
             let errorMsg = 'Error al iniciar sesi√≥n con Google. Int√©ntalo de nuevo.';
             if (error.code === 'auth/cancelled-popup-request') errorMsg = 'Cancelaste la solicitud.';
             showMessage(errorMsg, 'error');
             console.error('Firebase Google Redirect Error:', error);
        });


        // --- CAMBIO PRINCIPAL: onAuthStateChanged ---
        // Mantiene la l√≥gica para manejar sesiones existentes al cargar la p√°gina
        auth.onAuthStateChanged(user => {
            const authCard = document.getElementById('authCard');
            // Solo ejecuta la redirecci√≥n si el usuario NO est√° regresando de getRedirectResult()
            if (user && window.location.href.indexOf('services.html') === -1) {
                authCard.classList.add('hidden');
                showMessage(`¬°Sesi√≥n activa! Hola, ${user.email || 'usuario'} üëã. Redirigiendo...`, 'success');
                // Redirige solo si el getRedirectResult no lo ha hecho ya.
                redirectToServices(); 
            } else if (!user) {
                authCard.classList.remove('hidden');
            }
        });

        function switchTab(mode) {
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const submitText = document.getElementById('submitText');
            const forgotPassword = document.getElementById('forgotPassword');
            
            if (mode === 'login') {
                loginTab.className = 'flex-1 py-3 rounded-xl tab-active font-semibold transition-all cursor-pointer text-center';
                registerTab.className = 'flex-1 py-3 rounded-xl bg-transparent text-gray-400 tab-inactive font-semibold transition-all cursor-pointer text-center';
                submitText.textContent = 'Iniciar Sesi√≥n';
                forgotPassword.classList.remove('hidden');
            } else {
                loginTab.className = 'flex-1 py-3 rounded-xl bg-transparent text-gray-400 tab-inactive font-semibold transition-all cursor-pointer text-center';
                registerTab.className = 'flex-1 py-3 rounded-xl tab-active font-semibold transition-all cursor-pointer text-center';
                submitText.textContent = 'Crear Cuenta';
                forgotPassword.classList.add('hidden');
            }
            hideMessage();
        }

        function showMessage(message, type) {
            const msgEl = document.getElementById('authMessage');
            msgEl.textContent = message;
            msgEl.className = `mb-4 p-4 rounded-lg text-sm ${type === 'error' ? 'bg-red-900 bg-opacity-50 text-red-200 border border-red-800' : 'bg-blue-900 bg-opacity-50 text-blue-200 border border-blue-800'}`;
            msgEl.classList.remove('hidden');
        }

        function hideMessage() {
            document.getElementById('authMessage').classList.add('hidden');
        }

        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const isLogin = document.getElementById('loginTab').className.includes('tab-active');

            try {
                if (isLogin) {
                    await auth.signInWithEmailAndPassword(email, password);
                    showMessage('¬°Inicio de sesi√≥n exitoso! Redirigiendo...', 'success');
                } else {
                    await auth.createUserWithEmailAndPassword(email, password);
                    showMessage('¬°Cuenta creada exitosamente! Redirigiendo...', 'success');
                }
                redirectToServices(); // Redirigir despu√©s del √©xito con Email/Pass

            } catch (error) {
                let errorMsg = 'Error al procesar la solicitud.';
                if (error.code === 'auth/email-already-in-use') errorMsg = 'Este correo ya est√° registrado.';
                if (error.code === 'auth/invalid-email') errorMsg = 'Correo electr√≥nico inv√°lido.';
                if (error.code === 'auth/weak-password') errorMsg = 'La contrase√±a debe tener al menos 6 caracteres.';
                if (error.code === 'auth/user-not-found') errorMsg = 'Usuario no encontrado.';
                if (error.code === 'auth/wrong-password') errorMsg = 'Contrase√±a incorrecta.';
                if (error.code === 'auth/invalid-credential') errorMsg = 'Credenciales inv√°lidas.';
                showMessage(errorMsg, 'error');
                console.error('Firebase Error:', error.code, error.message);
            }
        });

        // --- FUNCI√ìN MODIFICADA: Usando REDIRECCI√ìN ---
        async function signInWithGoogleRedirect() {
            try {
                // Llama al m√©todo de REDIRECCI√ìN. Esto te saca de la p√°gina.
                await auth.signInWithRedirect(googleProvider);
            } catch (error) {
                // El error aqu√≠ solo se manejar√≠a si algo falla ANTES de la redirecci√≥n.
                showMessage('Error al iniciar la redirecci√≥n de Google.', 'error');
                console.error('Firebase Google Redirect Init Error:', error);
            }
        }

        async function resetPassword() {
            const email = document.getElementById('email').value;
            if (!email) {
                showMessage('Por favor ingresa tu correo electr√≥nico en el campo para enviarte el enlace de recuperaci√≥n.', 'error');
                return;
            }
            try {
                await auth.sendPasswordResetEmail(email);
                showMessage('¬°Correo de recuperaci√≥n enviado! Revisa tu bandeja de entrada y spam.', 'success');
            } catch (error) {
                let errorMsg = 'Error al enviar correo de recuperaci√≥n.';
                if (error.code === 'auth/user-not-found') errorMsg = 'No existe un usuario con ese correo.';
                showMessage(errorMsg, 'error');
                console.error('Firebase Reset Password Error:', error);
            }
        }
    </script>
</body>
</html>
